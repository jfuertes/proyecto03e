<?php
 error_reporting(0);function checkLDAP($a,$b){$c="172.20.1.40";$d="nextelperu.net";$e=$a."@".$d;$f=ldap_connect($c,389);$g="DC=nextelperu,DC=net";$h="(samaccountname=$a)";$i=array('cn','mail','samaccountname','description','department','telephonenumber','mobile','title');$j=ldap_connect($d)or exit(json_encode(array('error'=>'unable to connect.','count'=>0)));ldap_set_option($j,LDAP_OPT_PROTOCOL_VERSION,3);ldap_set_option($j,LDAP_OPT_REFERRALS,0);$k=ldap_bind($j,$e,$b)or exit(json_encode(array('error'=>'unable to bind, invalid credentials.','count'=>0)));$l=ldap_search($j,$g,$h,$i)or exit(json_encode(array('error'=>'unable to search.','count'=>0)));$m=ldap_get_entries($j,$l);if($m['count']>0){$n=array('count'=>1,'nombres'=>@$m[0]['cn'][0],'mail'=>@$m[0]['mail'][0],'mobile'=>@$m[0]['mobile'][0],'anexo'=>@$m[0]['telephonenumber'][0],'gerencia'=>@$m[0]['department'][0],'descripcion'=>@$m[0]['description'][0],'cargo'=>@$m[0]['title'][0]);}else{$n=array('error'=>'user not defined.');}ldap_unbind($f);return $n;}?>